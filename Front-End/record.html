{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGC - Add Record</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>
    <div class="container">
        <header>
            <a href="{% url 'index' %}" class="back-link" title="Back to Home">&larr;</a>
            <h1>Add New Record</h1>
        </header>

        <main class="main-content">
            {% csrf_token %}

            <section class="card semester-card">
                <h2>Semester Details</h2>

                <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                    <select id="semester-select"
                        style="padding: 10px; border-radius: 8px; border: none; background: #f4f4f7; font-size: 1rem;">
                        <option value="1">Semester 1</option>
                        <option value="2">Semester 2</option>
                    </select>
                    <select id="year-select"
                        style="padding: 10px; border-radius: 8px; border: none; background: #f4f4f7; font-size: 1rem;">
                    </select>
                </div>

                <div id="dynamic-subject-list" class="subject-list">
                </div>

                <button id="add-subject-btn"
                    style="background: #000000; color: white; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; margin-top: 15px;">
                    + Add Subject
                </button>
            </section>

            <div class="result-area">
                <button id="calculate-gpa-btn" class="btn-primary">Calculate & Save</button>
                <div id="final-gpa"></div>
            </div>
        </main>
    </div>

    <script src="{% static 'js/app.js' %}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const token = localStorage.getItem("access");
            const refresh = localStorage.getItem("refresh");
            if (!token) {
                window.location.href = "/login/";
                return;
            }

            try {
                const res = await fetch("/api/gpa-tracking/", {
                    headers: { "Authorization": "Bearer " + token }
                });

                if (res.status === 401) {
                    console.warn("Token expired or invalid, redirecting to login...");
                    localStorage.removeItem("access");
                    localStorage.removeItem("refresh");
                    window.location.href = "/login/";
                }
            } catch (err) {
                console.error("Error verifying token:", err);
                window.location.href = "/login/";
            }
        });
    </script>
</body>

</html>